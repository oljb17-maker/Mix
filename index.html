<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Kairos Mix ‚Äî Garage Pro</title>
<style>
:root{color-scheme:light dark}
body{font-family:-apple-system,system-ui,Segoe UI,Roboto,Arial;margin:0;padding:16px}
.card{max-width:860px;margin:auto;border:1px solid rgba(127,127,127,.35);border-radius:16px;padding:16px}
h1{margin:0 0 6px;font-size:22px}
.sub{opacity:.8;margin:0 0 12px}
.grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
@media (max-width:640px){.grid{grid-template-columns:1fr}}
button,select,input{
 width:100%;padding:12px;border-radius:12px;border:1px solid rgba(127,127,127,.45);
 font-size:16px;background:transparent;font-weight:800
}
.small{font-size:13px;opacity:.85;margin-top:10px}
.row{display:flex;gap:10px;flex-wrap:wrap}
.row > *{flex:1 1 180px}
.out{margin-top:12px;padding:14px;border-radius:14px;background:rgba(127,127,127,.12)}
.big{font-size:20px;font-weight:900;margin-top:6px}
.pill{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid rgba(127,127,127,.35);font-size:12px}
.warn{margin-top:10px;padding:10px;border-radius:12px;background:rgba(255,165,0,.12);border:1px solid rgba(255,165,0,.35)}
.ok{margin-top:10px;padding:10px;border-radius:12px;background:rgba(0,255,170,.10);border:1px solid rgba(0,255,170,.25)}
hr{border:none;border-top:1px solid rgba(127,127,127,.25);margin:14px 0}
kbd{border:1px solid rgba(127,127,127,.45);padding:2px 6px;border-radius:8px;font-size:12px;opacity:.9}
</style>
</head>
<body>
<div class="card">
  <h1>Kairos Mix <span class="pill">Garage Pro</span></h1>
  <p class="sub">APC + Agua ‚Ä¢ calcula por color, claridad, zona y tama√±o. (Agua:APC)</p>

  <div class="row">
    <div>
      <div class="small">Tama√±o del contenedor</div>
      <select id="total">
        <option value="250">250 ml</option>
        <option value="500" selected>500 ml</option>
        <option value="750">750 ml</option>
        <option value="1000">1000 ml</option>
      </select>
    </div>

    <div>
      <div class="small">Modo</div>
      <select id="mode">
        <option value="normal" selected>Normal (limpieza interior)</option>
        <option value="vapor">Vapor (pre-spray para aflojar + vapor)</option>
      </select>
    </div>

    <div>
      <div class="small">Medici√≥n</div>
      <select id="measure">
        <option value="exact" selected>Exacto (vaso graduado)</option>
        <option value="easy">Redondeado seguro</option>
      </select>
    </div>

    <div>
      <div class="small">Zona</div>
      <select id="zone">
        <option value="dash" selected>Tablero (delicado)</option>
        <option value="doors">Puertas / paneles</option>
        <option value="console">Consola central (m√°s tocada)</option>
        <option value="wheel">Volante / palanca</option>
        <option value="lower">Pl√°sticos bajos (umbral / kick panel)</option>
      </select>
    </div>
  </div>

  <hr>

  <div class="small">üé® Por combinaci√≥n de interior</div>
  <div class="grid" style="margin-top:8px">
    <button onclick="pick('negro_negro')">Negro - Negro</button>
    <button onclick="pick('negro_gris')">Negro - Gris</button>
    <button onclick="pick('blanco_gris')">Blanco - Gris</button>
    <button onclick="pick('blanco_blanco')">Blanco - Blanco</button>
  </div>

  <div class="small">üåó Por claridad</div>
  <div class="grid" style="margin-top:8px">
    <button onclick="pick('claro')">Interior Claro</button>
    <button onclick="pick('medio_claro')">Medio claro</button>
    <button onclick="pick('medio_oscuro')">Medio oscuro</button>
    <button onclick="pick('oscuro')">Oscuro</button>
  </div>

  <div class="row" style="margin-top:10px">
    <button onclick="saveFav()">üìå Guardar favorito</button>
    <button onclick="loadFav()">‚≠ê Cargar favorito</button>
    <button onclick="resetUI()">‚Ü∫ Reset</button>
  </div>

  <div class="out">
    <div class="small" id="label">Preset: ‚Äî</div>
    <div class="big" id="mix">‚Äî</div>
    <div class="small" id="meta">‚Äî</div>

    <div class="warn" id="tips" style="display:none">
      Interior claro: roc√≠a en microfibra (no directo), seca inmediato, vapor suave y r√°pido. Pantallas: NO APC / NO vapor.
    </div>
    <div class="ok" id="quick" style="display:none"></div>
  </div>

  <div class="small" style="margin-top:12px">
    Atajos: <kbd>Vapor</kbd> sube diluci√≥n (m√°s seguro). <kbd>Zona</kbd> ajusta 1‚Äì2 pasos. <kbd>Redondeado</kbd> te da medidas f√°ciles.
  </div>
</div>

<script>
// =====================
// BASE RATIOS (Agua:APC)
// =====================
const BASE = {
  negro_negro: 10,
  negro_gris: 12,
  blanco_gris: 15,
  blanco_blanco: 20,

  claro: 15,
  medio_claro: 12,
  medio_oscuro: 10,
  oscuro: 8
};

// =====================
// Vapor: hacerlo M√ÅS diluido
// =====================
function vaporBoost(r){
  if (r >= 20) return 20;
  if (r >= 15) return 15;
  if (r >= 12) return 15; // 12 -> 15
  if (r >= 10) return 12; // 10 -> 12
  return 12;              // 8 -> 12
}

// =====================
// Zona: ajustes seguros
// (subir n√∫mero = m√°s diluido / m√°s seguro)
// =====================
function zoneAdjust(r, zone){
  // tablero y volante: m√°s suaves
  if (zone === "dash") return Math.max(r, 12) + (r >= 15 ? 0 : 1);
  if (zone === "wheel") return Math.max(r, 12); // no muy fuerte
  // consola: un poco m√°s fuerte (bajar ratio)
  if (zone === "console") return Math.max(8, r - 2);
  // puertas: normal
  if (zone === "doors") return r;
  // pl√°sticos bajos: toleran m√°s fuerza
  if (zone === "lower") return Math.max(6, r - 2);
  return r;
}

// =====================
// Redondeos f√°ciles para vaso
// calcula APC aproximado seg√∫n ratio y total
// =====================
function roundEasy(total, ratio){
  // apc exact
  const apcExact = total / (ratio + 1);

  // reglas simples por rangos (seguras)
  if (ratio >= 20) return Math.round(total * 0.05 / 5) * 5;   // ~5%
  if (ratio >= 15) return Math.round(total * 0.06 / 5) * 5;   // ~6%
  if (ratio >= 12) return Math.round(total * 0.08 / 5) * 5;   // ~7.7-8%
  if (ratio >= 10) return Math.round(total * 0.10 / 5) * 5;   // ~9-10%
  if (ratio >= 8)  return Math.round(total * 0.12 / 5) * 5;   // ~11-12%
  return Math.round(apcExact / 5) * 5;
}

function fmt(n, exact){
  const dec = exact ? 1 : 0;
  return n.toFixed(dec);
}

// Estado
let lastKey = null;
let lastBaseRatio = 15;

function compute(baseRatio){
  const total = parseFloat(document.getElementById('total').value);
  const mode = document.getElementById('mode').value;
  const measure = document.getElementById('measure').value;
  const zone = document.getElementById('zone').value;
  const exact = (measure === 'exact');

  let r = baseRatio;

  // aplicar zona (sobre base)
  r = zoneAdjust(r, zone);

  // aplicar vapor (al final para seguridad)
  if (mode === 'vapor') r = vaporBoost(r);

  // calcular mezcla
  let apc = total / (r + 1);
  if (!exact) apc = roundEasy(total, r);

  const water = total - apc;

  // UI
  document.getElementById('mix').textContent =
    `APC ${fmt(apc, exact)} ml  ‚Ä¢  Agua ${fmt(water, exact)} ml`;

  document.getElementById('meta').textContent =
    `${mode === 'vapor' ? 'Vapor' : 'Normal'} ‚Ä¢ Zona: ${zoneName(zone)} ‚Ä¢ ${r}:1 (agua:APC) ‚Ä¢ Total ${total} ml`;

  // tips para claros
  const showTips = (r >= 15) || (lastKey && (lastKey.includes("blanco") || lastKey === "claro"));
  document.getElementById('tips').style.display = showTips ? 'block' : 'none';

  // quick note
  const q = document.getElementById('quick');
  q.style.display = 'block';
  q.innerHTML = quickAdvice(mode, zone, r);
}

function zoneName(z){
  return ({
    dash:"Tablero",
    doors:"Puertas",
    console:"Consola",
    wheel:"Volante",
    lower:"Pl√°sticos bajos"
  })[z] || z;
}

function quickAdvice(mode, zone, r){
  const lines = [];
  if (mode === "vapor") lines.push("‚úîÔ∏è Pre-spray ligero ‚Üí vapor suave ‚Üí microfibra seca inmediato.");
  if (zone === "console") lines.push("‚úîÔ∏è Consola: ok un poco m√°s fuerte, pero no empapar botones.");
  if (zone === "dash") lines.push("‚úîÔ∏è Tablero: mejor m√°s diluido, 2 pasadas suaves.");
  if (zone === "wheel") lines.push("‚úîÔ∏è Volante: NO empapar, limpiar y secar al instante.");
  if (r <= 8) lines.push("‚ö†Ô∏è Mezcla fuerte: evita piano black, pantallas y zonas sensibles.");
  lines.push("üö´ Pantallas: solo pa√±o + limpiador de pantalla (sin APC / sin vapor).");
  return lines.join("<br>");
}

// Preset button
function pick(key){
  lastKey = key;
  lastBaseRatio = BASE[key] ?? 12;
  document.getElementById('label').textContent = `Preset: ${key.replaceAll('_',' ')}`;
  compute(lastBaseRatio);
}

// Recalcular cuando cambie algo
["total","mode","measure","zone"].forEach(id=>{
  document.getElementById(id).addEventListener("change", ()=>compute(lastBaseRatio));
});

// Favorito
const FAV_KEY = "kairos_mix_favorite_v1";

function saveFav(){
  const fav = {
    total: document.getElementById('total').value,
    mode: document.getElementById('mode').value,
    measure: document.getElementById('measure').value,
    zone: document.getElementById('zone').value,
    lastKey,
    lastBaseRatio
  };
  localStorage.setItem(FAV_KEY, JSON.stringify(fav));
  document.getElementById('label').textContent = `üìå Favorito guardado (${lastKey ?? "custom"})`;
}

function loadFav(){
  const raw = localStorage.getItem(FAV_KEY);
  if(!raw){
    document.getElementById('label').textContent = "‚≠ê No hay favorito guardado todav√≠a.";
    return;
  }
  const fav = JSON.parse(raw);
  document.getElementById('total').value = fav.total ?? "500";
  document.getElementById('mode').value = fav.mode ?? "normal";
  document.getElementById('measure').value = fav.measure ?? "exact";
  document.getElementById('zone').value = fav.zone ?? "dash";
  lastKey = fav.lastKey ?? "blanco_gris";
  lastBaseRatio = fav.lastBaseRatio ?? 15;
  document.getElementById('label').textContent = `‚≠ê Favorito: ${String(lastKey).replaceAll('_',' ')}`;
  compute(lastBaseRatio);
}

function resetUI(){
  document.getElementById('total').value="500";
  document.getElementById('mode').value="normal";
  document.getElementById('measure').value="exact";
  document.getElementById('zone').value="dash";
  pick('blanco_gris');
}

// Inicial (Lucie safe)
pick('blanco_gris');
</script>
</body>
</html>